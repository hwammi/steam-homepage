<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>계산 및 시뮬레이션 데이터 — STEAM Project Hub</title>
  <meta name="description" content="상-장 이론 기반 파라미터 분석/다중 입자·전극 단위 시뮬레이션, 액체전해질 범용 퍼텐셜 개발 데이터셋 선택 페이지" />
  <style>
    :root{
      --bg:#0b0d12; --fg:#e8ecf3; --muted:#a5afc2; --card:#12161f; --border:#1c2230;
      --accent:#7c9cff; --accent2:#00d1b2; --shadow:0 10px 30px rgba(0,0,0,.35); --r:18px;
      --pop-dur:.8s; --pop-ease:cubic-bezier(.16,1,.3,1); --pop-scale:1.03;
      --overlay-dur:.5s; --modal-dur:.55s; --modal-ease:cubic-bezier(.16,1,.3,1);
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f7f9fc; --fg:#0d1117; --muted:#536075; --card:#ffffff; --border:#e6eaf1; --accent:#3b82f6; --accent2:#14b8a6; }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--fg); font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Arial}
    a{color:inherit; text-decoration:none}
    .container{width:min(100%,1100px); margin:0 auto; padding:24px 20px}
    header{position:sticky; top:0; z-index:10; backdrop-filter:saturate(120%) blur(8px); background:color-mix(in srgb,var(--bg),transparent 20%); border-bottom:1px solid var(--border)}
    .nav{display:flex; align-items:center; justify-content:space-between; height:64px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:800}
    .mark{width:28px; height:28px; border-radius:8px; background:linear-gradient(135deg,var(--accent),var(--accent2))}

    .hero{padding:28px 0}
    .hero h1{margin:0 0 6px; font-size:clamp(22px,4.5vw,36px); line-height:1.15}
    .hero p{margin:0; color:var(--muted)}
    .crumbs{display:flex; gap:8px; align-items:center; font-size:14px; color:var(--muted)}
    .crumbs a{color:var(--muted)}

    .list{display:grid; gap:22px; grid-template-columns:1fr; margin-top:22px}

    .card{position:relative; background:var(--card); border:1px solid var(--border); border-radius:var(--r); padding:16px; box-shadow:var(--shadow);
      transition:transform var(--pop-dur) var(--pop-ease), box-shadow var(--pop-dur) var(--pop-ease), filter var(--pop-dur) ease}
    .card:hover,.card:focus-within{transform:translateY(-6px) scale(var(--pop-scale)); box-shadow:0 20px 50px rgba(0,0,0,.5); filter:brightness(1.02)}
    .card .uploader{position:absolute; right:12px; top:12px}

    figure{margin:0; border:1px dashed var(--border); border-radius:14px; overflow:hidden; background:color-mix(in srgb,var(--card),transparent 40%);}
    .preview{width:100%; aspect-ratio:21/9; object-fit:cover; display:block}
    figcaption{font-weight:800; text-align:center; margin-top:10px}

    .uploader input{display:none}
    .btn{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:10px; border:1px solid var(--border); cursor:pointer; background:rgba(255,255,255,.03)}

    footer{padding:40px 0 60px; color:var(--muted)}

    .modal{position:fixed; inset:0; display:grid; place-items:center; background:rgba(0,0,0,0); opacity:0; pointer-events:none; transition:background var(--overlay-dur) ease, opacity var(--overlay-dur) ease}
    .modal.open{background:rgba(0,0,0,.45); opacity:1; pointer-events:auto}
    .panel{width:min(96vw, 980px); max-height:90vh; background:var(--card); border:1px solid var(--border); border-radius:20px; box-shadow:0 30px 90px rgba(0,0,0,.6);
      transform:translateY(18px) scale(.98); opacity:.98; transition:transform var(--modal-dur) var(--modal-ease), opacity var(--modal-dur) var(--modal-ease)}
    .modal.open .panel{transform:translateY(0) scale(1); opacity:1}
    .panel header{display:flex; justify-content:space-between; align-items:center; padding:16px 18px; border-bottom:1px solid var(--border)}
    .panel header h2{margin:0; font-size:20px}
    .close{border:1px solid var(--border); background:transparent; color:var(--fg); border-radius:10px; padding:6px 10px; cursor:pointer}
    .panel .inner{display:grid; grid-template-columns:1fr; gap:18px; padding:18px}
    @media (min-width:900px){ .panel .inner{grid-template-columns:1.2fr 1fr} }
    .bigpreview{border:1px dashed var(--border); border-radius:14px; overflow:hidden; display:grid; place-items:center; background:color-mix(in srgb,var(--card),transparent 40%)}
    .bigpreview img{max-width:100%; height:auto; display:block}

    .attachments h3{margin:0 0 8px}
    .attach-actions{display:flex; gap:8px; align-items:center}
    .attach-actions input[type=file]{display:none}
    .chips{display:grid; gap:10px}
    .chip{display:flex; justify-content:space-between; align-items:center; gap:10px; border:1px solid var(--border); border-radius:12px; padding:10px 12px}
    .chip a{font-weight:700}
    .chip button{border:1px solid var(--border); background:transparent; color:var(--fg); border-radius:10px; padding:4px 8px; cursor:pointer}
    .empty{color:var(--muted); font-size:14px}
    .card .uploader { display: none !important; }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand"><span class="mark" aria-hidden="true"></span> STEAM Project Hub</div>
      <nav aria-label="보조">
        <a href="database.html" style="font-size:14px; color:var(--muted)">← 데이터베이스</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="crumbs"><a href="index.html">홈</a> › <a href="database.html">데이터베이스</a> › <span>계산 및 시뮬레이션</span></div>
    <section class="hero" aria-label="타이틀">
      <h1>계산 및 시뮬레이션 데이터 (2개)</h1>
      <p>블록을 클릭하면 같은 화면에서 팝업이 열리고, 첨부 파일을 다운로드할 수 있습니다.</p>
    </section>

    <section class="list" aria-label="데이터 소스 선택">
      <article class="card" data-id="phase" role="button" tabindex="0">
        <div class="uploader"><label class="btn" for="phaseImg">대표 이미지</label><input id="phaseImg" type="file" accept="image/*"></div>
        <figure>
          <img id="phasePreview" class="preview" alt="상-장 이론 기반 파라미터 분석 미리보기" src="assets/para_thumb.png" />
          <figcaption>상-장 이론을 통한 파라미터 분석: 다중 입자 및 전극 단위의 시뮬레이션 구축</figcaption>
        </figure>
      </article>

      <article class="card" data-id="uep" role="button" tabindex="0">
        <div class="uploader"><label class="btn" for="uepImg">대표 이미지</label><input id="uepImg" type="file" accept="image/*"></div>
        <figure>
          <img id="uepPreview" class="preview" alt="액체전해질 범용 퍼텐셜 개발 미리보기" src="assets/pote_thumb.png" />
          <figcaption>액체전해질의 시뮬레이션이 가능한 범용성 퍼텐셜 개발</figcaption>
        </figure>
      </article>
    </section>
  </main>

  <footer>
    <div class="container" style="display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap">
      <div class="brand"><span class="mark" aria-hidden="true"></span> <strong>STEAM Project Hub</strong></div>
      <div>© <span id="y"></span> STEAM Project Hub</div>
    </div>
  </footer>

  <!-- Modal for attachments -->
  <div class="modal" id="datasetModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" hidden>
    <div class="panel">
      <header>
        <h2 id="modalTitle">데이터셋</h2>
        <button class="close" id="closeModal" aria-label="닫기">닫기</button>
      </header>
      <div class="inner">
        <div class="bigpreview"><img id="modalImg" alt="선택한 데이터셋 미리보기"></div>
        <div class="attachments">
          <h3>첨부된 데이터셋</h3>
          <div class="attach-actions">
            <label class="btn" for="attachInput">파일 추가</label>
            <input id="attachInput" type="file" multiple />
          </div>
          <div class="chips" id="attachList"><div class="empty">아직 첨부된 파일이 없습니다.</div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- 공통 헬퍼 -->
  <script>
  (()=>{
    const DB_NAME='steam-previews', STORE='images';
    const CFG={MAX_W:1400, MAX_H:740, QUALITY:0.74}; // 가로폭이 넓어 살짝 키움
    function openDB(){return new Promise((res,rej)=>{const r=indexedDB.open(DB_NAME,1);r.onupgradeneeded=()=>r.result.createObjectStore(STORE,{keyPath:'key'});r.onsuccess=()=>res(r.result);r.onerror=()=>rej(r.error)})}
    function tx(db,mode='readonly'){return db.transaction(STORE,mode).objectStore(STORE)}
    async function putImage(key,blob){const db=await openDB();await new Promise((res,rej)=>{const r=tx(db,'readwrite').put({key,blob,mime:blob.type,t:Date.now()});r.onsuccess=()=>res();r.onerror=()=>rej(r.error)})}
    async function getImage(key){const db=await openDB();return await new Promise((res,rej)=>{const r=tx(db).get(key);r.onsuccess=()=>res(r.result||null);r.onerror=()=>rej(r.error)})}
    function imgFromBlob(blob){const url=URL.createObjectURL(blob);const img=new Image();img.decoding='async';return new Promise((res,rej)=>{img.onload=()=>res({img,url});img.onerror=rej;img.src=url})}
    async function compress(file,{maxW=CFG.MAX_W,maxH=CFG.MAX_H,quality=CFG.QUALITY}={}){try{if(file.type.includes('svg'))return file;if(file.size<=250_000)return file;const {img,url}=await imgFromBlob(file);const w=img.naturalWidth,h=img.naturalHeight;const scale=Math.min(maxW/w,maxH/h,1);const tw=Math.max(1,Math.round(w*scale));const th=Math.max(1,Math.round(h*scale));const c=document.createElement('canvas');c.width=tw;c.height=th;const ctx=c.getContext('2d');ctx.drawImage(img,0,0,tw,th);URL.revokeObjectURL(url);const mime='image/jpeg';const blob=await new Promise(res=>c.toBlob(res,mime,quality));return blob||file}catch(e){console.warn('compress failed',e);return file}}
    async function loadPreview(key){const rec=await getImage(key);return rec?{url:URL.createObjectURL(rec.blob),mime:rec.mime}:null}
    async function persistPreview({inputId,imgId,key}){const input=document.getElementById(inputId);const img=document.getElementById(imgId);try{const got=await loadPreview(key);if(got){img.src=got.url;img.alt=img.alt||'saved preview'}}catch{}input?.addEventListener('change',async()=>{const f=input.files&&input.files[0];if(!f)return;const small=await compress(f);await putImage(key,small);const old=img.src;img.src=URL.createObjectURL(small);if(old?.startsWith('blob:')) URL.revokeObjectURL(old);img.alt=f.name})}
    window.persistPreview=persistPreview;
  })();
  </script>

  <!-- 페이지 스크립트 -->
  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    // 대표 이미지(영구)
    persistPreview({ inputId:'phaseImg', imgId:'phasePreview', key:'sim:phase' });
    persistPreview({ inputId:'uepImg',   imgId:'uepPreview',   key:'sim:uep'   });

    // ===== Modal + attachment logic (그대로) =====
    const modal = document.getElementById('datasetModal');
    const closeBtn = document.getElementById('closeModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalImg = document.getElementById('modalImg');
    const attachInput = document.getElementById('attachInput');
    const attachList = document.getElementById('attachList');

    const DATASETS = {
      phase: { name: '상-장 이론을 통한 파라미터 분석: 다중 입자 및 전극 단위의 시뮬레이션 구축' },
      uep:   { name: '액체전해질의 시뮬레이션이 가능한 범용성 퍼텐셜 개발' }
    };
    const store = new Map();
    let currentId = null;

    function openModal(id){
      currentId = id;
      const cardImg = document.getElementById(id+'Preview');
      modalImg.src = cardImg.src; modalImg.alt = DATASETS[id].name + ' 대표 이미지';
      modalTitle.textContent = DATASETS[id].name;
      renderList();
      modal.hidden = false; modal.classList.add('open');
      closeBtn.focus();
      document.addEventListener('keydown', escToClose);
    }
    function closeModal(){
      modal.classList.remove('open');
      modal.addEventListener('transitionend', ()=>{ modal.hidden = true; }, { once:true });
      document.removeEventListener('keydown', escToClose);
      currentId = null;
    }
    function escToClose(e){ if(e.key==='Escape') closeModal(); }
    modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
    closeBtn.addEventListener('click', closeModal);

    function renderList(){
      const files = store.get(currentId) || [];
      attachList.innerHTML = '';
      if(files.length === 0){
        const emp = document.createElement('div'); emp.className='empty'; emp.textContent='아직 첨부된 파일이 없습니다.'; attachList.appendChild(emp); return;
      }
      files.forEach((f, idx)=>{
        const chip = document.createElement('div'); chip.className='chip';
        const left = document.createElement('div');
        const a = document.createElement('a'); a.href = f.url; a.download = f.name; a.textContent = f.name; a.rel='noopener';
        left.appendChild(a);
        const actions = document.createElement('div');
        const del = document.createElement('button'); del.textContent='삭제';
        del.addEventListener('click', ()=>{ URL.revokeObjectURL(f.url); files.splice(idx,1); store.set(currentId, files); renderList(); });
        actions.appendChild(del);
        chip.appendChild(left); chip.appendChild(actions);
        attachList.appendChild(chip);
      });
    }

    attachInput.addEventListener('change', ()=>{
      if(!currentId) return;
      const files = store.get(currentId) || [];
      Array.from(attachInput.files||[]).forEach(file=>{
        files.push({ name:file.name, url: URL.createObjectURL(file) });
      });
      store.set(currentId, files); attachInput.value=''; renderList();
    });

    document.querySelectorAll('.card').forEach(card=>{
      card.addEventListener('click', (e)=>{ if(e.target.closest('.uploader')) return; openModal(card.dataset.id); });
      card.addEventListener('keydown', (e)=>{ if(e.target.closest('.uploader')) return; if(e.key==='Enter'||e.key===' ') { e.preventDefault(); openModal(card.dataset.id); } });
    });
  </script>
</body>
</html>
